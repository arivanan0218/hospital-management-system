<!DOCTYPE html>
<html>
<head>
    <title>Test Bed Status Detection</title>
</head>
<body>
    <h1>Test Frontend Bed Status Detection</h1>
    
    <div>
        <p>Testing if frontend can detect bed status queries...</p>
        <button onclick="testBedStatus()">Test "check bed 401A status"</button>
        <div id="result"></div>
    </div>

    <script>
        async function testBedStatus() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                // This simulates what the frontend service would do
                const message = "check bed 401A status";
                console.log('Testing message:', message);
                
                // Test bed number extraction
                const bedMatch = message.match(/bed\s+([A-Z0-9-]+)/i);
                if (bedMatch) {
                    const bedId = bedMatch[1];
                    console.log('Extracted bed ID:', bedId);
                    
                    // Test if it matches the bed status condition
                    const isStatus = message.includes('bed') && 
                                   (message.includes('cleaning') || message.includes('status') || message.includes('turnover'));
                    
                    if (isStatus) {
                        console.log('✅ Should call get_bed_status_with_time_remaining');
                        
                        // Test actual API call
                        const response = await fetch('http://localhost:8000/tools/call', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                "jsonrpc": "2.0",
                                "id": 1,
                                "method": "tools/call",
                                "params": {
                                    "name": "get_bed_status_with_time_remaining",
                                    "arguments": {
                                        "bed_id": bedId
                                    }
                                }
                            })
                        });
                        
                        const result = await response.json();
                        console.log('API Result:', result);
                        
                        // Parse result
                        const content = result.result?.content?.[0]?.text;
                        if (content) {
                            const data = JSON.parse(content);
                            if (data.success && data.result) {
                                const bedData = data.result;
                                resultDiv.innerHTML = `
                                    <h3>✅ SUCCESS!</h3>
                                    <p><strong>Bed ${bedData.bed_number} Status:</strong></p>
                                    <ul>
                                        <li>Current Status: ${bedData.current_status}</li>
                                        <li>Process Status: ${bedData.process_status}</li>
                                        <li>Time Remaining: ${bedData.time_remaining_minutes} minutes</li>
                                        <li>Progress: ${bedData.progress_percentage?.toFixed(1)}%</li>
                                    </ul>
                                    <p><em>The frontend detection is working correctly!</em></p>
                                `;
                                return;
                            }
                        }
                    } else {
                        console.log('❌ Did not match bed status condition');
                    }
                }
                
                resultDiv.innerHTML = '❌ Detection failed';
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `❌ Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
