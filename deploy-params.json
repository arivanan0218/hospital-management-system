{
  "InstanceIds": ["i-0002b69cc4efed969"],
  "DocumentName": "AWS-RunShellScript",
  "TimeoutSeconds": 300,
  "Parameters": {
    "commands": [
      "echo '=== FRESH COMPLETE DEPLOYMENT ==='",
      "sudo yum install -y curl wget",
      "cd /home/ec2-user",
      "sudo rm -rf hospital-management",
      "mkdir -p hospital-management",
      "cd hospital-management",
      "echo 'Downloading docker-compose file directly:'",
      "wget -O docker-compose.prod.yml https://raw.githubusercontent.com/arivanan0218/hospital-management-system/dev/docker-compose.prod.yml",
      "echo 'File downloaded:'",
      "ls -la docker-compose.prod.yml",
      "echo 'File content check:'",
      "head -5 docker-compose.prod.yml",
      "echo 'Logging into ECR:'",
      "aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 324037286635.dkr.ecr.us-east-1.amazonaws.com",
      "echo 'Clean up any existing containers:'",
      "docker system prune -f",
      "echo 'Pull images:'",
      "docker pull 324037286635.dkr.ecr.us-east-1.amazonaws.com/hospital-backend:latest",
      "docker pull 324037286635.dkr.ecr.us-east-1.amazonaws.com/hospital-frontend:latest",
      "docker pull postgres:15-alpine",
      "echo 'Start containers with explicit environment:'",
      "AWS_ACCOUNT_ID=324037286635 AWS_REGION=us-east-1 IMAGE_TAG=latest POSTGRES_PASSWORD=Arivu2001 docker-compose -f docker-compose.prod.yml up -d",
      "echo 'Wait for startup:'",
      "sleep 30",
      "echo 'Final check:'",
      "docker ps",
      "docker-compose -f docker-compose.prod.yml ps",
      "echo 'Test frontend on port 80:'",
      "curl -I http://localhost:80",
      "echo 'Test backend on port 8000:'",
      "curl -I http://localhost:8000"
    ]
  }
}
